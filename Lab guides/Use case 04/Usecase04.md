# ユースケース04-Azure OpenAI ServiceとRAGを使用したチャットアプリの構築(.NETを使用)

このサンプルでは、Retrieval Augmented Generation
パターンを使用して、自分のデータに対して ChatGPT
のようなエクスペリエンスを作成するためのいくつかの方法を示します。Azure
OpenAI Service を使用して ChatGPT モデル (gpt-4o-mini)
にアクセスし、Azure AI Search
を使用してデータのインデックス作成と取得を行います。

リポジトリにはサンプルデータが含まれているため、エンド ツー
エンドで試す準備ができています。このサンプルアプリケーションでは、Contoso
Electronicsという架空の会社を使用しており、そのエクスペリエンスにより、従業員は福利厚生、内部ポリシー、職務内容、役割について質問できます。

![コンピュータプロセスの図 説明が自動的に生成される](./media/image1.png)

- ボイスチャット、チャット、Q&Aインターフェース

- 引用、ソースコンテンツの追跡など、ユーザーが回答の信頼性を評価するのに役立つさまざまなオプションを検討します。

- データの準備、迅速な構築、およびモデル (ChatGPT) とレトリーバー (Azure
  AI Search)
  の間の対話のオーケストレーションのための可能なアプローチを示します

- UXで直接設定して、動作を微調整し、オプションを試します

**使用した主なテクノロジ** -- Azure OpenAI Service、ChatGPT モデル
(gpt-4o-mini)、Azure AI Search

**推定所要時間 --** 40 分

# 演習 1 : アプリケーションをデプロイし、ブラウザーからテストする

## タスク 1: オープンな開発環境

1.  ブラウザを開き、アドレスバーに移動して、次のURLを入力または貼り付けます:+++https://github.com/technofocus-pte/azure-search-openai-demo-csharp.git+++

> そしてGithubアカウントでサインインします。
>
> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image2.png)

2.  「**Fork」をクリックします**。

> ![](./media/image3.png)

3.  リポジトリ名を入力し、 **\[Create fork**\] をクリックします。

> ![](./media/image4.png)

4.  Code -\> Codespaces -\> + **をクリックします。**

> ![](./media/image5.png)

5.  環境がセットアップされるのを待ちます。5〜10分かかります。

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image6.png)

## タスク 2: チャット アプリを構築して Azure にデプロイするために必要なサービスをプロビジョニングする

1.ターミナルで次のコマンドを実行します。コードをコピーしてEnterキーを押します。

> +++azd auth login+++
>
> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image7.png)

2.  デフォルトのブラウザが開き、コードを入力します。コピーしたコードを入力し、\[**Next**をクリックします。

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image8.png)

![](./media/image9.png)

3.  Azure の資格情報でサインインします。

![自動的に生成されたコンピューターの \[説明\]
のスクリーンショット](./media/image10.png)

![コンピュータエラーのスクリーンショット
自動的に生成された説明](./media/image11.png)

![コンピューターのスクリーンショット
説明が自動的に生成される](./media/image12.png)

4.  Github の Codespace
    タブに戻ります。次のコマンドを実行して、現在のディレクトリのプロジェクト環境を初期化します。\[環境名\]
    に「+++chatragXXX+++」と入力し、Enter キーを押します。

> 注 : env 名は一意である必要があります
>
> +++azd env new+++

![](./media/image13.png)

5.  次のコマンドを実行してサービスを Azure
    にプロビジョニングし、コンテナーをビルドします。

> +++azd env set AZURE_RESOURCE_GROUP ResourceGroup1+++
>
> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image14.png)

6.  azd up を実行する - これにより、Azure
    リソースがプロビジョニングされ、./data
    フォルダーで見つかったファイルに基づいて検索インデックスを作成するなど、このサンプルがそれらのリソースにデプロイされます。

> **+++azd up+++**
>
> ![](./media/image15.png)

7.  以下の値を選択します。

- **使用する Azure サブスクリプションを選択する** :
  サブスクリプションを選択します

- **使用する Azure のロケーションを選択します**: **East us2/west us2**
  (米国東部が利用できない場合がある場合は、以下の一覧から場所を選択します)。

- 既存のリソースグループの選択 :
  既存のリソースグループ(例:**ResourceGroup1)**

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image16.png)
>
> ![](./media/image17.png)

7.リソースが完全にプロビジョニングされるまで待ちます。このプロセスでは、必要なリソースをすべて作成するのに5〜10分かかります。

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image18.png)
>
> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image19.png)
>
> ![](./media/image20.png)

8.  アプリケーションが正常にデプロイされると、ターミナルに URL
    が表示されます。**URLをコピーします**

> ![](./media/image21.png)

9.  \[**Open\]をクリックします 。**

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image22.png)

10. 新しいタブでアプリが開きます。

> ![](./media/image23.png)

11. ブラウザーを開き、<https://portal.azure.com>に移動して 、Azure
    サブスクリプション アカウントでサインインします。

12. ホームページで、**Resource Groupsをクリックします**

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image24.png)

13. resource groupをクリックします。

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image25.png)

14. 以下のリソースが正常にデプロイされたことを確認します

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image26.png)

![コンピューターのスクリーンショット
説明が自動的に生成される](./media/image27.png)

![コンピューターのスクリーンショット
説明が自動的に生成される](./media/image28.png)

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image29.png)

15. リソース グループで、 **Azure OpenAI** リソース名をクリックします。

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image30.png)

16. **Azure OpenAI** ウィンドウで、 **左側のナビゲーション メニューの**
    \[**Overview**\] をクリックし、**Get Started** タブで**Go to Azure
    OpenAI Studio**ボタンをクリックして、新しいブラウザーで **Azure
    OpenAI Studio** を開きます。

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image31.png)

17. **gpt-4o-mini**、**text-embedding-ada-002**が正常にデプロイされていることを確認してください。

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image32.png)

18. リソース グループで、 **storage
    account**リソース名をクリックします。

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image33.png)
>
> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image34.png)

19. 次に、URLをブラウザで開きます

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image23.png)

20. チャット**をクリックします**

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image35.png)

21. **Blazor OpenAI** Web アプリ ページで、次のテキストを入力し、
    **次の図に示すように** \[**Submit**\] アイコンをクリックします。

**+++What is included in my Northwind Health Plus plan that is not in
standard?+++**

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image36.png)
>
> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image37.png)

22. **Blazor OpenAI** Web アプリ ページで、次のテキストを入力し、
    **次の図に示すように** \[**Submit**\] アイコンをクリックします。

> **+++Can I use out-of-network providers?+++**
>
> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image38.png)
>
> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image39.png)

23. **Blazor OpenAI** Web アプリ ページで、次のテキストを入力し、
    **次の図に示すように** \[**Submit**\] アイコンをクリックします。

> **+++Are there any exclusions or restrictions?+++**
>
> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image40.png)
>
> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image41.png)

24. **Blazor OpenAI** Web アプリ ページで、次のテキストを入力し、
    **次の図に示すように** \[**Submit**\] アイコンをクリックします。

> **+++What does a Product Manager do?+++**
>
> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image42.png)

25. **Documents**をクリックします**。**

> ![コンピューターのスクリーンショット
> 説明が自動的に生成される](./media/image43.png)

## **タスク 3 : すべてのリソースをクリーンアップする**

1.  **Azure portal -\> Resource group-\> Resource group nameに戻ります**

> ![自動的に生成されたコンピューターの \[説明\]
> のスクリーンショット](./media/image44.png)

2.  すべてのリソースを選択し、次の画像に示すように\[Delete\]をクリックします。(**DO
    NOT DELETE** リソース・グループ)

> ![](./media/image45.png)

3.  テキストボックスに「delete」と入力し、\[**Delete**\]をクリックします。

> ![](./media/image46.png)

4.  \[**Delete\]をクリックして削除を確認します**。

> ![](./media/image47.png)

5.  Githubポータルタブに戻り、ページを更新します。

> ![](./media/image48.png)

6.  \[Code\]
    をクリックし、このラボ用に作成したブランチを選択して、\[**Delete**\]
    をクリックします。

> ![](./media/image49.png)

7.  \[**Delete** **\]ボタンをクリックして、ブランチの削除を確認します**
    。

![](./media/image50.png)

**概要：**

このユース ケースでは、Azure で実行される検索拡張生成パターンのチャット
アプリケーションをデプロイし、検索には Azure AI Search を使用し、ChatGPT
スタイルと Q&A エクスペリエンスを強化するために Azure OpenAI と
LangChain large language models (LLM) を使用します。
